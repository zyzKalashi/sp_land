<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="common :: head">
<title id="pageTitle">登录系统~四平市铁西区农经总站土地流转管理平台</title>
</head>

<body>
	<div id="app" v-cloak onLoad="vm.GetCookie();">
		<header th:include="common :: header"></header>
		<div th:include="common :: nav"></div>
		<!-- Content Begin -->
		<div class="fabu2 public2">
			<div class="fl">
				<img src="../static/images/main/denglu.png" class="pt10" width="600" height="360">
			</div>
			<div class="fr public2 mr30 mt30">
				<div class="Column_content" style="margin-top: 15px;">
					<div class="am-form tpl-form-line-form am-u-sm-12 ">
						<div class="am-form-group">
							<input type="text" AUTOCOMPLETE="off" class="loginText" id="userName" autofocus placeholder="请输入账号" v-model="user.userName">
						</div>
						<div class="am-form-group">
							<input type="password" class="loginText" id="password" placeholder="请输入密码" v-model="user.password" @keyup.13="login($event)">
						</div>
						<div class="am-form-group">
							<span>验证：</span>
						</div>
						<div class="am-form-group tpl-login-remember-me">
							<input id="remember-me" type="checkbox" style="height: auto">
							<label for="remember-me">自动登录</label>
						</div>
					</div>
					<div class="am-text-center am-padding">
						<button type="button" class="am-btn am-btn-danger" @click="login">登录</button>
						<button type="button" class="am-btn am-btn-warning" onclick="goUrl('/html/register')">注册</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Footer Begin -->
		<div th:include="common :: footer"></div>
		<!-- Footer END -->
	</div>
	<div th:include="common :: js"></div>
	<script type="text/javascript">
		var vm = new Vue({
			el : '#app',
			data : {
				user : {
					userName : '',
					password : '',
				},
			},
			mounted : function() {
			},
			methods : {
				checkNull : function() {
					if (!vm.user.userName) {
						layer.msg("请输入用户名！");
						$("#userName").focus();
						return false;
					}
					if (!vm.user.password) {
						layer.msg("请输入密码！");
						$("#password").focus();
						return false;
					} else {
						this.remeber();
						return true;
					}
				},
				login : function() {
					if (vm.checkNull()) {
						// 记住密码
						vm.user.password = hex_md5(vm.user.password);
						hzToolObj.postRpc("/login", vm.user).done(
								function(result) {
									if (result.code == 0) {
										window.location.href = "/index";
									} else {
										layer.msg(result.msg);
									}
								});
					}
				},
				// 记住密码
				remeber : function() {
					var isChecked = $("input[type='checkbox']").is(':checked');
					if (isChecked) {
						// 用户名为空，undefined、“”、null都可以判断
						if (!vm.user.userName && !vm.user.password) {
							return;
						}
						this.SetCookie(vm.user.userName, vm.user.password);
					}
				},
				SetCookie : function(username, password) {
					var Then = new Date();
					Then.setTime(Then.getTime() + 1866240000000);
					document.cookie = "username=" + username + "%%" + password
							+ ";expires=" + Then.toGMTString();
				},
				GetCookie : function() {
					var nmpsd;
					var nm;
					var psd;
					var cookieString = new String(document.cookie);
					var cookieHeader = "username=";
					var beginPosition = cookieString.indexOf(cookieHeader);
					cookieString = cookieString.substring(beginPosition);
					var ends = cookieString.indexOf(";");
					if (ends != -1) {
						cookieString = cookieString.substring(0, ends);
					}
					if (beginPosition > -1) {
						nmpsd = cookieString.substring(cookieHeader.length);
						if (nmpsd != "") {
							beginPosition = nmpsd.indexOf("%%");
							nm = nmpsd.substring(0, beginPosition);
							psd = nmpsd.substring(beginPosition + 2);
							this.user.userName = nm;
							this.user.password = psd;
							if (nm != "" && psd != "") {
								$("#remember-me").prop("checked", true);
							}
						}
					}
				}

			},
		});
	</script>
</body>
</html>
