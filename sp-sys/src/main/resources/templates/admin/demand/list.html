<!doctype html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>铁西区农村经济总站土地流转交易监管平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" type="text/css" th:href="@{/static/css/bootstrap/bootstrap.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/static/plugin/jeDate/jeDate.css}">
    <script th:src="@{/static/js/jquery.min.js}"></script>
    <script th:src="@{/static/js/bootstrap/bootstrap.js}"></script>
    <script th:src="@{/static/js/vue.min.js}"></script>
    <script th:src="@{/static/plugin/layer/layer.js}"></script>
    <script th:src="@{../static/plugin/pagination/jquery.pagination.js}"></script>
    <script th:src="@{../static/plugin/pagination/bootstrap-paginator.js}"></script>
    <script th:src="@{/static/js/common.js}"></script>
    <script th:src="@{/static/plugin/jeDate/jeDate.js}"></script>
</head>
<style>
    .btn{
        width: auto;
    }
    .current{
        background-color: #F2F2F2;
    }
    .layer-skin .layui-layer-btn a{
        background-color: #965818;
        border: 1px solid #965818;
    }
</style>
<body>
<div id="vueApp">
    <form role="form">
        <div class="form-group form-inline">
            <label class="col-sm-2" for="title">标题</label>
            <div class="col-sm-2">
                <input class="form-control" id="title" v-model="form.title" type="text" placeholder="请输入标题" style="width: 90%;"/>
            </div>
            <label class="col-sm-2" for="noticeKind">法规类别</label>
            <div class="col-sm-2">
                <select class="form-control" id="noticeKind" v-model="form.noticeKind" placeholder="请选择法规类别" style="width: 90%;" >
                    <option></option>
                    <option v-for="(name,key) in kinds" :value="key">{{name}}</option>
                </select>
            </div>
            <label class="col-sm-2" for="noticeStatus">法规状态</label>
            <div class="col-sm-2">
                <select class="form-control" id="noticeStatus" v-model="form.noticeStatus" placeholder="请选择法规状态" style="width: 90%;" >
                    <option></option>
                    <option v-for="(name,key) in status" :value="key">{{name}}</option>
                </select>
            </div>
        </div>
        <div class="form-group form-inline">
            <label class="col-sm-2" for="startDate">开始时间</label>
            <div class="col-sm-2">
                <input id="startDate" type="text" placeholder="请输入开始时间" style="width: 90%;"/>
            </div>
            <label class="col-sm-2" for="endDate">终止时间</label>
            <div class="col-sm-2">
                <input id="endDate" type="text" placeholder="请输入终止时间" style="width: 90%;"/>
            </div>
            <div class="col-sm-4" style="text-align: right;">
                <div style="width: 95%;">
                    <button type="button" @click="doQuery('1')" class="btn btn-sm btn-primary">查询</button>
                    <button type="button" @click="doModify()" class="btn btn-sm btn-warning">新增</button>
                </div>
            </div>
        </div>
    </form>
    <div class="row mx-auto" style="margin-top: 10px;">
        <div class="col-12">
            <table class="table table-hover table-bordered table-sm">
                <thead class="thead-default">
                <tr class="text-center">
                    <th>法规标题</th>
                    <th>法规类别</th>
                    <th>法规状态</th>
                    <th>创建时间</th>
                    <th style="width: 20%;">操作</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="(notice,index) in list" class="text-center">
                    <td>{{notice.title}}</td>
                    <td>{{notice.noticeKind}}</td>
                    <td>{{notice.noticeStatus}}</td>
                    <td>{{notice.createDateStr}}</td>
                    <td class="inline">
                        <button type="button" class="btn btn-sm btn-warning" @click="doModify(user)">修改</button>
                        <button type="button" class="btn btn-sm btn-warning" @click="doModify(user)">删除</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row mx-auto text-center">
        <ul id='pagination'></ul>
    </div>
</div>
</body>
<script>
    $(function () {
        jeDate("#startDate",{
            theme:{ bgcolor:"#00A1CB",color:"#ffffff", pnColor:"#00CCFF"},
            isinitVal:false,
            onClose:true,
            isTime:true,
            format: 'YYYY-MM-DD'
        });

        jeDate("#endDate",{
            theme:{ bgcolor:"#00A1CB",color:"#ffffff", pnColor:"#00CCFF"},
            isinitVal:false,
            onClose:true,
            isTime:true,
            format: 'YYYY-MM-DD'
        });
    })

    let vm = new Vue({
        el: "#vueApp",
        data: {
            form: {
                title:'',
                noticeKind:'',
                noticeStatus:'',
                pageNo: 1,
                pageSize: 2,
            },
            list: [],
            status:{},
            kinds:{},
        },
        mounted : function() {
            this.doQuery();
        },
        created: function(){
            let _this = this;
            $.post("/user/allRoles",null,function(resp){
                let obj = {};
                for(let i=0;i < resp.result.length;i++){
                    obj[resp.result[i].roleId] = resp.result[i].roleName;
                }
                _this.roleInfos = obj;
            });
            $.get("/user/getUserStatus","", function (resp) {
                if(0 == resp.code){
                    _this.status = resp.status;
                }
            });
        },
        methods:{
            doQuery: function(currPage){
                let obj = {};
                for(let x in this.form){
                    if(this.form[x]){
                        obj[x] = this.form[x];
                    }
                }
                if($("#startDate").val()){
                    obj.startDate = $("#startDate").val();
                }
                if($("#endDate").val()){
                    obj.endDate = $("#endDate").val();
                }
                hzToolObj.getdomInit("/notice/noticeSearch", obj, this.callback, currPage);
            },
            callback: function(result){
                this.list = result.pageInfo.list;
            },
            doModify: function(user){
                let userId = "";
                let title = "新增用户";
                if(user && user.userId){
                    userId =  user.userId;
                    title = "修改用户-" + user.userName;
                }

                layer.open({
                    type: 2,
                    title: title,
                    area: ['90%', '90%'],
                    fixed: true, //不固定
                    skin: 'layer-skin',
                    maxmin: true,
                    content: '/admin/userModify?userId=' + userId,
                    btn:['保存','清空','关闭'],
                    yes: function(index, layero){
                        let iframeWin = window[layero.find('iframe')[0]['name']];
                        iframeWin.vm.save();
                    },
                    btn2: function(index, layero){
                        let iframeWin = window[layero.find('iframe')[0]['name']];
                        iframeWin.vm.clear();
                        return false;
                    },
                    btn3: function(){
                    },
                });
            }
        }
    })
</script>
</html>