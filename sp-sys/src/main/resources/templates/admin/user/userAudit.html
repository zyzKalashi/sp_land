<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title id="pageTitle">注册会员—铁西区农村经济总站土地流转交易监管平台</title>
    <link rel="stylesheet" type="text/css" th:href="@{/static/css/bootstrap/bootstrap.css}">
</head>
<style>
    label{
        margin-right: 10px;
    }
</style>
<body>
<div id="app" v-cloak>
    <hr>
    <div class="row inline" style="width: 95%;margin-top: 10px;">
        <div class="col-sm-7">
            <div class="row inline">
                <div class="col-sm-6 offset-sm-2 text-right">
                    <label class="control-label">会员ID:</label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">{{user.userId}}</label>
                </div>
            </div>
            <div class="row inline">
                <div class="col-sm-6 offset-sm-2 text-right">
                    <label class="control-label">会员名称:</label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">{{user.userName}}</label>
                </div>
            </div>
            <div class="row inline">
                <div class="col-sm-6 offset-sm-2 text-right">
                    <label class="control-label">邮箱:</label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">{{user.email}}</label>
                </div>
            </div>
            <div class="row inline">
                <div class="col-sm-6 offset-sm-2 text-right">
                    <label class="control-label">手机号:</label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">{{user.mobile}}</label>
                </div>
            </div>
            <div class="row inline">
                <div class="col-sm-6 offset-sm-2 text-right">
                    <label class="control-label">用户状态:</label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">{{userStatus}}</label>
                </div>
            </div>
            <div class="row inline">
                <div class="col-sm-6 offset-sm-2 text-right">
                    <label class="control-label">所属角色:</label>
                </div>
                <div class="col-sm-4">
                    <label class="control-label">{{roleName}}</label>
                </div>
            </div>
        </div>
        <div class="col-sm-4" style="height: auto;">
            <div class="row" style="margin-top: 30px;">
                    <img src="../static/images/cent/touxiang.jpg" style="border-radius: 5px; box-shadow: 0 1px 2px 1px #666;">
            </div>
        </div>
    </div>
    <hr>
</div>
</body>
<script th:src="@{/static/js/jquery.min.js}"></script>
<script th:src="@{/static/js/bootstrap/bootstrap.js}"></script>
<script th:src="@{/static/js/vue.min.js}"></script>
<script th:src="@{/static/js/md5_32.js}"></script>
<script th:src="@{/static/plugin/layer/layer.js}"></script>
<script type="text/javascript">
    var userId = '[[${userId}]]';

    var vm = new Vue({
        el: '#app',
        data: {
            user: {
                userId: userId,
                userName: '',
                email: '',
                mobile: '',
                password: '',
                password_v: '',
                userStatus: '',
                roleId: '',
            },
            status:{},
            roleInfos:{},
            userStatus:'',
            roleName:'',
        },
        watch: {
            status: {
                handler(newValue, oldValue) {
                    this.flushStatus();
                },
                deep: true
            },
            roleInfos: {
                handler(newValue, oldValue) {
                    this.flushRoleName()
                },
                deep: true
            },
            user: {
                handler(newValue, oldValue) {
                    this.flushStatus();
                    this.flushRoleName();
                },
                deep: true
            },
        },
        created: function(){
            var _this = this;

            $.get("/user/getUserStatus","", function (resp) {
                if(0 == resp.code){
                    _this.status = resp.status;
                }
            });

            var _this = this;
            $.post("/user/allRoles",null,function(resp){
                if(0 == resp.code){
                    var obj = new Object();
                    for(var i=0;i < resp.result.length;i++){
                        obj[resp.result[i].roleId] = resp.result[i].roleName;
                    }
                    _this.roleInfos = obj;
                }
            });

            if(userId){
                $.post("/user/userDetail?userId=" + userId, "", function(resp){
                    if(0 == resp.code){
                        for(var x in _this.user){
                            _this.user[x] = resp.userData[x];
                        }
                    } else {
                        _this.clear();
                        layer.msg("获取用户信息失败！");
                    }
                });
            }
        },
        methods : {
            audit: function (userId, type) {
                var tUser = new Object();
                tUser.userId = userId;
                tUser.userStatus = type;

                $.post("/user/users_modify", tUser, function (result) {
                    if (result.code == 0) {
                        layer.msg("保存成功！",{icon:1, time:2000, shade:0.4},function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        });
                        parent.vm.doQuery();
                    } else {
                        layer.msg(result.msg);
                    }
                });
            },
            flushStatus: function(){
                if(("0" == this.user.userStatus || this.user.userStatus) && this.status[this.user.userStatus]){
                    this.userStatus = this.status[this.user.userStatus];
                }
            },
            flushRoleName: function(){
                if(("0" == this.user.roleId || this.user.roleId) && this.roleInfos[this.user.roleId]){
                    this.roleName = this.roleInfos[this.user.roleId];
                }
            }
        },
    });
</script>
</html>
